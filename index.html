<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Cosmic Drift VR</title>
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

  <style>
    html, body { margin:0; height:100%; background:#000; overflow:hidden; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; }
    .hud{
      position:fixed; left:14px; right:14px; bottom:16px; z-index:10;
      color:rgba(255,255,255,.86); text-shadow:0 2px 12px rgba(0,0,0,.8);
      font-size:14px; line-height:1.35; pointer-events:none;
    }
    .chip{
      display:inline-block; padding:8px 10px; border-radius:12px;
      background:rgba(0,0,0,.42); border:1px solid rgba(255,255,255,.18);
      backdrop-filter: blur(6px); -webkit-backdrop-filter: blur(6px);
      font-weight:700; letter-spacing:.2px;
      margin-bottom:8px;
    }
  </style>

  <script>
    // ====== TUNING KNOBS ======
    const SKY_BACK_SPIN_MS   = 110000;   // ~1.8 min / rotation (visible motion)
    const SKY_FRONT_SPIN_MS  = 78000;    // faster counter-rotation (parallax)
    const BG_SWITCH_MS       = 75000;    // switch backgrounds every 75s

    const STAR_MIN_MS        = 30000;    // shooting stars every 30–60 seconds
    const STAR_MAX_MS        = 60000;

    // Planet spin: big objects should feel slow
    const SPIN_EARTH_MS      = 140000;
    const SPIN_JUPITER_MS    = 220000;
    const SPIN_SATURN_MS     = 210000;
    const SPIN_URANUS_MS     = 190000;
    const SPIN_MOON_MS       = 120000;

    // Cosmic drift (world movement) — keep subtle for VR comfort
    const DRIFT_ROT_SPEED    = 0.00055;
    const DRIFT_SWAY_SPEED   = 0.00070;
    const DRIFT_SWAY_AMOUNT  = 0.30;

    // ====== COMPONENTS ======
    AFRAME.registerComponent('ring-drift', {
      init: function () {
        this.t = 0;
        this.baseX = this.el.object3D.position.x;
        this.baseZ = this.el.object3D.position.z;
      },
      tick: function (time, dt) {
        const d = dt || 16;
        this.t += d;

        // slow drift rotation
        this.el.object3D.rotation.y += DRIFT_ROT_SPEED * d;

        // gentle sway
        const s = Math.sin(this.t * DRIFT_SWAY_SPEED);
        const c = Math.cos(this.t * DRIFT_SWAY_SPEED * 0.92);
        this.el.object3D.position.x = this.baseX + s * DRIFT_SWAY_AMOUNT;
        this.el.object3D.position.z = this.baseZ + c * DRIFT_SWAY_AMOUNT;
      }
    });

    // TRUE random scheduler (not setInterval with one-time random)
    AFRAME.registerComponent('shooting-stars', {
      schema: { minMs:{default:30000}, maxMs:{default:60000}, maxAlive:{default:1} },
      init: function () {
        this.alive = 0;
        this._timer = null;
        this.schedule();
      },
      schedule: function () {
        const wait = this.data.minMs + Math.random() * (this.data.maxMs - this.data.minMs);
        clearTimeout(this._timer);
        this._timer = setTimeout(() => this.spawn(), wait);
      },
      spawn: function () {
        if (this.alive >= this.data.maxAlive) { this.schedule(); return; }
        this.alive++;

        const holder = this.el;
        const star = document.createElement('a-entity');

        // start high-ish and far-ish
        const startX = (Math.random() * 18) - 9;
        const startY = 7 + Math.random() * 4;
        const startZ = -26 - Math.random() * 10;

        // end diagonally across
        const dir = Math.random() < 0.5 ? -1 : 1;
        const endX = startX + dir * (10 + Math.random() * 10);
        const endY = startY - (3 + Math.random() * 3);
        const endZ = startZ - (6 + Math.random() * 8);

        star.setAttribute('position', `${startX.toFixed(2)} ${startY.toFixed(2)} ${startZ.toFixed(2)}`);
        star.setAttribute('rotation', `0 0 ${(-25 + Math.random()*50).toFixed(2)}`);

        // streak (thin cylinder)
        star.setAttribute('geometry', 'primitive: cylinder; radius: 0.02; height: 2.2;');
        star.setAttribute('material', 'color:#fff; emissive:#fff; emissiveIntensity:0.85; opacity:0.95; transparent:true;');

        star.setAttribute('animation__move', {
          property: 'position',
          to: `${endX.toFixed(2)} ${endY.toFixed(2)} ${endZ.toFixed(2)}`,
          dur: 1400,
          easing: 'easeOutQuad'
        });
        star.setAttribute('animation__fade', {
          property: 'material.opacity',
          to: 0,
          dur: 1400,
          easing: 'easeOutQuad'
        });

        holder.appendChild(star);

        setTimeout(() => {
          if (star.parentNode) star.parentNode.removeChild(star);
          this.alive--;
          this.schedule();
        }, 1500);
      },
      remove: function () { clearTimeout(this._timer); }
    });
  </script>
</head>

<body>
  <div class="hud">
    <span class="chip">Cosmic Drift · Parallax Sky · 5 Planets · Shooting Stars</span><br/>
    Sky rotates + fades between 2 backgrounds · Stars every 30–60s
  </div>

  <a-scene
    vr-mode-ui="enabled: true"
    renderer="antialias:true; colorManagement:true; physicallyCorrectLights:true; precision:high;"
    background="color:#000"
  >
    <a-assets timeout="20000">
      <!-- Your two sky photos -->
      <img id="bg1" src="space-background-realistic-starry-night-cosmos-shining-stars-milky-way-stardust-color-galaxy.jpg">
      <img id="bg2" src="space-background-realistic-starry-night-cosmos-shining-stars-milky-way-stardust-color-galaxy (1).jpg">

      <!-- Your planet textures -->
      <img id="earthTex"   src="earth_tex.jpg">
      <img id="jupiterTex" src="jupiter_tex.jpg">
      <img id="saturnTex"  src="saturn_tex.jpg">
      <img id="uranusTex"  src="uranus_tex.jpg">
      <img id="moonTex"    src="moon_tex.jpg">
    </a-assets>

    <!-- Camera (stable for VR comfort) -->
    <a-entity id="rig" position="0 1.6 0">
      <a-camera wasd-controls-enabled="false" look-controls></a-camera>
    </a-entity>

    <!-- Light (soft, not flashlight-y) -->
    <a-entity light="type: ambient; intensity: 0.72"></a-entity>
    <a-entity light="type: directional; intensity: 0.52" position="2 3 1"></a-entity>

    <!-- PARALLAX SKY: back layer -->
    <a-sky
      id="skyBack"
      src="#bg1"
      material="shader:flat; side:back; transparent:true; opacity:1"
      rotation="0 0 0"
      animation__spin="property: rotation; to: 0 360 0; loop:true; dur: 110000; easing: linear"
      animation__wobble="property: rotation; dir:alternate; to: 1.3 0 -1.3; loop:true; dur: 26000; easing: easeInOutSine"
    ></a-sky>

    <!-- PARALLAX SKY: front haze layer (same image, lower opacity, opposite spin) -->
    <a-sky
      id="skyFront"
      src="#bg1"
      material="shader:flat; side:back; transparent:true; opacity:0.26"
      rotation="0 0 0"
      animation__spin="property: rotation; to: 0 -360 0; loop:true; dur: 78000; easing: linear"
      animation__wobble="property: rotation; dir:alternate; to: -2 0 2; loop:true; dur: 33000; easing: easeInOutSine"
    ></a-sky>

    <!-- WORLD / PLANET FIELD -->
    <a-entity id="planetField" ring-drift>

      <!-- Spread around the player (not bunched) -->
      <!-- Earth: front-right-ish -->
      <a-entity position="10 2 -6"
        animation__bob="property: position; dir:alternate; to: 10 2.35 -6; loop:true; dur: 11000; easing: easeInOutSine"
        animation__spin="property: rotation; to: 0 360 0; loop:true; dur: 140000; easing: linear">
        <a-sphere radius="1.15" segments-width="64" segments-height="64"
          material="src:#earthTex; roughness:1; metalness:0.02"></a-sphere>
      </a-entity>

      <!-- Jupiter: left -->
      <a-entity position="-13 2 0"
        animation__bob="property: position; dir:alternate; to: -13 2.45 0; loop:true; dur: 13000; easing: easeInOutSine"
        animation__spin="property: rotation; to: 0 360 0; loop:true; dur: 220000; easing: linear">
        <a-sphere radius="1.9" segments-width="64" segments-height="64"
          material="src:#jupiterTex; roughness:1; metalness:0.02"></a-sphere>
      </a-entity>

      <!-- Saturn: behind -->
      <a-entity position="2 2 13" rotation="10 0 -10"
        animation__bob="property: position; dir:alternate; to: 2 2.35 13; loop:true; dur: 12000; easing: easeInOutSine"
        animation__spin="property: rotation; to: 10 360 -10; loop:true; dur: 210000; easing: linear">
        <a-sphere radius="1.35" segments-width="64" segments-height="64"
          material="src:#saturnTex; roughness:1; metalness:0.02"></a-sphere>
        <a-ring radius-inner="1.55" radius-outer="2.65" rotation="75 0 0"
          material="color:#d8c3a3; opacity:0.55; transparent:true; side:double"></a-ring>
      </a-entity>

      <!-- Uranus: far front-left -->
      <a-entity position="-5 1.7 -14" rotation="0 0 20"
        animation__bob="property: position; dir:alternate; to: -5 2.05 -14; loop:true; dur: 12500; easing: easeInOutSine"
        animation__spin="property: rotation; to: 0 360 20; loop:true; dur: 190000; easing: linear">
        <a-sphere radius="1.35" segments-width="64" segments-height="64"
          material="src:#uranusTex; roughness:1; metalness:0.02"></a-sphere>
      </a-entity>

      <!-- Moon: above-ish -->
      <a-entity position="0.8 6.2 2"
        animation__bob="property: position; dir:alternate; to: 0.8 6.45 2; loop:true; dur: 8000; easing: easeInOutSine"
        animation__spin="property: rotation; to: 0 360 0; loop:true; dur: 120000; easing: linear">
        <a-sphere radius="0.7" segments-width="64" segments-height="64"
          material="src:#moonTex; roughness:1; metalness:0.0"></a-sphere>
      </a-entity>

    </a-entity>

    <!-- Shooting stars controller (30–60 seconds) -->
    <a-entity id="stars" shooting-stars="minMs: 30000; maxMs: 60000; maxAlive: 1"></a-entity>

    <script>
      // ===== Background switching (fade BOTH parallax layers) =====
      const skyBack  = document.getElementById('skyBack');
      const skyFront = document.getElementById('skyFront');
      let using1 = true;

      function fadeSwapSky(el, nextSrc, targetOpacity) {
        el.setAttribute('animation__fadeout', { property:'material.opacity', to:0, dur:900, easing:'easeInOutQuad' });
        setTimeout(() => {
          el.setAttribute('src', nextSrc);
          el.setAttribute('animation__fadein', { property:'material.opacity', to:targetOpacity, dur:1200, easing:'easeInOutQuad' });
        }, 900);
      }

      function swapBackgrounds() {
        const next = using1 ? '#bg2' : '#bg1';
        using1 = !using1;
        fadeSwapSky(skyBack,  next, 1.0);
        fadeSwapSky(skyFront, next, 0.26);
      }

      // Auto-switch every 75 seconds
      setInterval(swapBackgrounds, 75000);

      // Optional: click to switch if you want it
      // skyBack.addEventListener('click', swapBackgrounds);
      // skyFront.addEventListener('click', swapBackgrounds);
    </script>
  </a-scene>
</body>
</html>

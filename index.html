<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Korndog Cosmic Drift</title>

  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/aframe-extras@6.1.1/dist/aframe-extras.min.js"></script>

  <style>
    html, body { margin:0; height:100%; background:#000; overflow:hidden; }
    .hint {
      position: fixed;
      left: 0; right: 0; bottom: 10px;
      text-align: center;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color: rgba(255,255,255,.8);
      font-size: 14px;
      pointer-events: none;
      text-shadow: 0 2px 10px rgba(0,0,0,.7);
    }
  </style>

  <script>
    // --- Shooting star spawner (lightweight, VR-safe) ---
    AFRAME.registerComponent("shooting-stars", {
      schema: {
        minDelayMs: { default: 30000 }, // 30s
        maxDelayMs: { default: 60000 }, // 60s
        durationMs: { default: 1800 }
      },
      init: function () {
        this.nextTimer = null;
        this.scheduleNext();
      },
      remove: function () {
        if (this.nextTimer) clearTimeout(this.nextTimer);
      },
      scheduleNext: function () {
        const d = this.data;
        const delay = d.minDelayMs + Math.random() * (d.maxDelayMs - d.minDelayMs);
        this.nextTimer = setTimeout(() => {
          this.spawnStar();
          this.scheduleNext();
        }, delay);
      },
      spawnStar: function () {
        const scene = this.el.sceneEl;

        // Spawn in the sky-ish area, far away
        const r = 180; // radius-ish
        const theta = Math.random() * Math.PI * 2;
        const phi = (Math.random() * 0.35 + 0.1) * Math.PI; // upper-ish hemisphere
        const start = new THREE.Vector3(
          r * Math.cos(theta) * Math.sin(phi),
          r * Math.cos(phi),
          r * Math.sin(theta) * Math.sin(phi)
        );

        // Move across a short arc
        const dir = new THREE.Vector3(
          (Math.random() - 0.5),
          (Math.random() - 0.2),
          (Math.random() - 0.5)
        ).normalize();
        const end = start.clone().add(dir.multiplyScalar(70));

        const star = document.createElement("a-entity");

        // Use a thin cylinder as the streak
        star.setAttribute("geometry", "primitive: cylinder; radius: 0.05; height: 18; segmentsRadial: 8;");
        star.setAttribute("material", "color: #ffffff; emissive: #ffffff; emissiveIntensity: 1; opacity: 0.0; transparent: true;");
        star.setAttribute("position", `${start.x} ${start.y} ${start.z}`);

        // Orient cylinder toward end
        const mid = start.clone().add(end).multiplyScalar(0.5);
        const look = end.clone();
        star.object3D.position.copy(mid);
        star.object3D.lookAt(look);
        // Tilt so cylinder aligns with its length axis
        star.object3D.rotateX(Math.PI / 2);

        // Animate: fade in -> travel -> fade out
        const dur = this.data.durationMs;

        star.setAttribute("animation__fadein",
          `property: material.opacity; from: 0; to: 0.85; dur: 250; easing: linear`);
        star.setAttribute("animation__move",
          `property: position; from: ${start.x} ${start.y} ${start.z}; to: ${end.x} ${end.y} ${end.z}; dur: ${dur}; easing: linear`);
        star.setAttribute("animation__fadeout",
          `property: material.opacity; from: 0.85; to: 0; dur: 300; delay: ${dur - 250}; easing: linear`);

        scene.appendChild(star);

        // Cleanup after done
        setTimeout(() => {
          if (star && star.parentNode) star.parentNode.removeChild(star);
        }, dur + 500);
      }
    });

    // --- Background crossfade switcher (NO parallax) ---
    AFRAME.registerComponent("bg-switch", {
      schema: {
        intervalMs: { default: 180000 }, // 3 minutes (change if you want)
        fadeMs: { default: 8000 }        // 8s fade
      },
      init: function () {
        this.skyA = document.querySelector("#skyA");
        this.skyB = document.querySelector("#skyB");
        this.usingA = true;

        // Start with A visible
        this.skyA.setAttribute("material", "opacity: 1; transparent: true;");
        this.skyB.setAttribute("material", "opacity: 0; transparent: true;");

        this.timer = setInterval(() => this.swap(), this.data.intervalMs);
      },
      remove: function () {
        if (this.timer) clearInterval(this.timer);
      },
      swap: function () {
        const fade = this.data.fadeMs;

        if (this.usingA) {
          // Fade A out, B in
          this.skyA.setAttribute("animation__op", `property: material.opacity; to: 0; dur: ${fade}; easing: linear`);
          this.skyB.setAttribute("animation__op", `property: material.opacity; to: 1; dur: ${fade}; easing: linear`);
        } else {
          // Fade B out, A in
          this.skyB.setAttribute("animation__op", `property: material.opacity; to: 0; dur: ${fade}; easing: linear`);
          this.skyA.setAttribute("animation__op", `property: material.opacity; to: 1; dur: ${fade}; easing: linear`);
        }

        this.usingA = !this.usingA;
      }
    });
  </script>
</head>

<body>
  <div class="hint">Deep space float • planets + cosmic drift • tap VR when ready</div>

  <a-scene
    renderer="colorManagement: true; physicallyCorrectLights: true; antialias: true;"
    vr-mode-ui="enabled: true"
    embedded>

    <a-assets>
      <!-- Your two backgrounds (as in your repo screenshots) -->
      <img id="bg1" src="space-background-realistic-starry-night-cosmos-shining-stars-milky-way-stardust-color-galaxy.jpg" crossorigin="anonymous" />
      <img id="bg2" src="space-background-realistic-starry-night-cosmos-shining-stars-milky-way-stardust-color-galaxy (1).jpg" crossorigin="anonymous" />

      <!-- Your planet textures from the repo -->
      <img id="earthTex"   src="earth_tex.jpg" crossorigin="anonymous" />
      <img id="jupiterTex" src="jupiter_tex.jpg" crossorigin="anonymous" />
      <img id="saturnTex"  src="saturn_tex.jpg" crossorigin="anonymous" />
      <img id="uranusTex"  src="uranus_tex.jpg" crossorigin="anonymous" />
      <img id="moonTex"    src="moon_tex.jpg" crossorigin="anonymous" />
    </a-assets>

    <!-- Lights (kept simple; the textures do most of the work) -->
    <a-entity light="type: ambient; intensity: 0.65"></a-entity>
    <a-entity light="type: directional; intensity: 0.75" position="2 4 1"></a-entity>

    <!-- Rig: joystick movement + head look -->
    <a-entity id="rig" movement-controls="speed: 0.05" position="0 1.6 0">
      <a-camera look-controls="pointerLockEnabled: false"></a-camera>
    </a-entity>

    <!-- SINGLE sky layer system (NO parallax). Two skies same radius used only to crossfade. -->
    <a-sky
      id="skyA"
      radius="500"
      src="#bg1"
      material="shader: flat; transparent: true; opacity: 1"
      rotation="0 0 0"
      animation="property: rotation; to: 0 360 0; loop: true; dur: 45000; easing: linear">
    </a-sky>

    <a-sky
      id="skyB"
      radius="500"
      src="#bg2"
      material="shader: flat; transparent: true; opacity: 0"
      rotation="0 0 0"
      animation="property: rotation; to: 0 360 0; loop: true; dur: 45000; easing: linear">
    </a-sky>

    <!-- Background switching + shooting stars controller -->
    <a-entity bg-switch="intervalMs: 180000; fadeMs: 8000" shooting-stars="minDelayMs: 30000; maxDelayMs: 60000;"></a-entity>

    <!-- Planets: spaced out around you, full spheres, slowed rotation (20s) -->
    <!-- Earth -->
    <a-sphere
      position="0 1.8 -10"
      radius="1.25"
      material="src: #earthTex; shader: standard; metalness: 0; roughness: 1; mipmap: false"
      animation="property: rotation; to: 0 360 0; loop: true; dur: 20000; easing: linear">
    </a-sphere>

    <!-- Jupiter -->
    <a-sphere
      position="10 2.5 2"
      radius="2.2"
      material="src: #jupiterTex; shader: standard; metalness: 0; roughness: 1; mipmap: false"
      animation="property: rotation; to: 0 360 0; loop: true; dur: 20000; easing: linear">
    </a-sphere>

    <!-- Uranus -->
    <a-sphere
      position="-10 2.0 4"
      radius="1.7"
      material="src: #uranusTex; shader: standard; metalness: 0; roughness: 1; mipmap: false"
      animation="property: rotation; to: 0 360 0; loop: true; dur: 20000; easing: linear">
    </a-sphere>

    <!-- Moon -->
    <a-sphere
      position="3 1.2 9"
      radius="0.75"
      material="src: #moonTex; shader: standard; metalness: 0; roughness: 1; mipmap: false"
      animation="property: rotation; to: 0 360 0; loop: true; dur: 20000; easing: linear">
    </a-sphere>

    <!-- Saturn (sphere + ring) -->
    <a-entity position="-6 2.3 -2">
      <a-sphere
        radius="1.9"
        material="src: #saturnTex; shader: standard; metalness: 0; roughness: 1; mipmap: false"
        animation="property: rotation; to: 0 360 0; loop: true; dur: 20000; easing: linear">
      </a-sphere>

      <!-- Simple ring (kept subtle, doesn’t strobe) -->
      <a-ring
        rotation="65 0 0"
        radius-inner="2.2"
        radius-outer="3.2"
        material="color: #d8cbb3; opacity: 0.35; transparent: true; side: double">
      </a-ring>
    </a-entity>

  </a-scene>
</body>
</html>

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Cosmic Drift VR</title>

  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

  <style>
    html, body { margin:0; height:100%; background:#000; overflow:hidden; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; }
    .hud{
      position:fixed; left:14px; right:14px; bottom:16px; z-index:10;
      color:rgba(255,255,255,.86);
      text-shadow:0 2px 12px rgba(0,0,0,.85);
      font-size:14px; line-height:1.35;
      pointer-events:none;
    }
    .chip{
      display:inline-block;
      padding:8px 10px;
      border-radius:12px;
      background:rgba(0,0,0,.42);
      border:1px solid rgba(255,255,255,.18);
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
      font-weight:800;
      letter-spacing:.2px;
      margin-bottom:8px;
    }
  </style>

  <script>
    // ========= TUNING KNOBS =========
    // Sky: you asked for 45 seconds because sundial movement sucks.
    const SKY_BACK_DUR_MS  = 45000;  // noticeable
    const SKY_FRONT_DUR_MS = 32000;  // parallax layer, slightly faster, opposite direction
    const SKY_FRONT_OPACITY = 0.22;  // haze strength

    // Planets: "slow" in VR means minutes, not seconds.
    // Interpreting your "20 secs" as "20 MINUTES".
    const PLANET_DUR_MS = 20 * 60 * 1000; // 20 minutes

    // Shooting stars: every 30–60 seconds
    const STAR_MIN_MS = 30000;
    const STAR_MAX_MS = 60000;

    // Background switching between your two sky photos
    const BG_SWITCH_MS = 75000; // 75 seconds (smooth vibe)

    // ========= COMPONENTS =========

    // TRUE random scheduler (not one-time random interval)
    AFRAME.registerComponent('shooting-stars', {
      schema: { minMs:{default:30000}, maxMs:{default:60000}, maxAlive:{default:1} },
      init: function () {
        this.alive = 0;
        this._timer = null;
        this.schedule();
      },
      schedule: function () {
        const wait = this.data.minMs + Math.random() * (this.data.maxMs - this.data.minMs);
        clearTimeout(this._timer);
        this._timer = setTimeout(() => this.spawn(), wait);
      },
      spawn: function () {
        if (this.alive >= this.data.maxAlive) { this.schedule(); return; }
        this.alive++;

        const holder = this.el;
        const star = document.createElement('a-entity');

        // Start high and far
        const startX = (Math.random() * 18) - 9;
        const startY = 7 + Math.random() * 4;
        const startZ = -28 - Math.random() * 10;

        // End diagonally across view
        const dir = Math.random() < 0.5 ? -1 : 1;
        const endX = startX + dir * (12 + Math.random() * 10);
        const endY = startY - (3 + Math.random() * 3);
        const endZ = startZ - (8 + Math.random() * 10);

        star.setAttribute('position', `${startX.toFixed(2)} ${startY.toFixed(2)} ${startZ.toFixed(2)}`);
        star.setAttribute('rotation', `0 0 ${(-25 + Math.random()*50).toFixed(2)}`);

        // streak (thin cylinder)
        star.setAttribute('geometry', 'primitive: cylinder; radius: 0.02; height: 2.4;');
        star.setAttribute('material', 'color:#fff; emissive:#fff; emissiveIntensity:0.85; opacity:0.95; transparent:true;');

        star.setAttribute('animation__move', {
          property: 'position',
          to: `${endX.toFixed(2)} ${endY.toFixed(2)} ${endZ.toFixed(2)}`,
          dur: 1400,
          easing: 'easeOutQuad'
        });
        star.setAttribute('animation__fade', {
          property: 'material.opacity',
          to: 0,
          dur: 1400,
          easing: 'easeOutQuad'
        });

        holder.appendChild(star);

        setTimeout(() => {
          if (star.parentNode) star.parentNode.removeChild(star);
          this.alive--;
          this.schedule();
        }, 1500);
      },
      remove: function () { clearTimeout(this._timer); }
    });
  </script>
</head>

<body>
  <div class="hud">
    <span class="chip">Cosmic Drift · Parallax Sky · 5 Planets · Shooting Stars</span><br/>
    Sky rotates fast enough to SEE · Planets rotate like REAL planets · Stars every 30–60s
  </div>

  <a-scene
    vr-mode-ui="enabled: true"
    renderer="antialias:true; colorManagement:true; physicallyCorrectLights:true; precision:high;"
    background="color:#000"
  >
    <a-assets timeout="20000">
      <!-- Your two sky photos -->
      <img id="bg1" src="space-background-realistic-starry-night-cosmos-shining-stars-milky-way-stardust-color-galaxy.jpg">
      <img id="bg2" src="space-background-realistic-starry-night-cosmos-shining-stars-milky-way-stardust-color-galaxy (1).jpg">

      <!-- Your planet textures -->
      <img id="earthTex"   src="earth_tex.jpg">
      <img id="jupiterTex" src="jupiter_tex.jpg">
      <img id="saturnTex"  src="saturn_tex.jpg">
      <img id="uranusTex"  src="uranus_tex.jpg">
      <img id="moonTex"    src="moon_tex.jpg">
    </a-assets>

    <!-- Camera (NO drift, NO joystick movement) -->
    <a-entity id="rig" position="0 1.6 0">
      <a-camera wasd-controls-enabled="false" look-controls></a-camera>
    </a-entity>

    <!-- Lighting: soft and consistent -->
    <a-entity light="type: ambient; intensity: 0.72"></a-entity>
    <a-entity light="type: directional; intensity: 0.52" position="2 3 1"></a-entity>

    <!-- PARALLAX SKY (NO wobble/pulsing) -->
    <a-sky
      id="skyBack"
      src="#bg1"
      material="shader:flat; side:back; transparent:true; opacity:1"
      rotation="0 0 0"
      animation__spin="property: rotation; to: 0 360 0; loop:true; dur: 45000; easing: linear"
    ></a-sky>

    <a-sky
      id="skyFront"
      src="#bg1"
      material="shader:flat; side:back; transparent:true; opacity:0.22"
      rotation="0 0 0"
      animation__spin="property: rotation; to: 0 -360 0; loop:true; dur: 32000; easing: linear"
    ></a-sky>

    <!-- PLANETS: SPACED AROUND YOU (no bunching) -->
    <a-entity id="planetField">

      <!-- Earth: right -->
      <a-entity position="11 2 -2"
        animation__spin="property: rotation; to: 0 360 0; loop:true; dur: 1200000; easing: linear">
        <a-sphere radius="1.2" segments-width="64" segments-height="64"
          material="src:#earthTex; roughness:1; metalness:0.02"></a-sphere>
      </a-entity>

      <!-- Jupiter: left -->
      <a-entity position="-14 2 1"
        animation__spin="property: rotation; to: 0 360 0; loop:true; dur: 1200000; easing: linear">
        <a-sphere radius="2.1" segments-width="64" segments-height="64"
          material="src:#jupiterTex; roughness:1; metalness:0.02"></a-sphere>
      </a-entity>

      <!-- Saturn: behind -->
      <a-entity position="2 2 15" rotation="10 0 -10"
        animation__spin="property: rotation; to: 10 360 -10; loop:true; dur: 1200000; easing: linear">
        <a-sphere radius="1.45" segments-width="64" segments-height="64"
          material="src:#saturnTex; roughness:1; metalness:0.02"></a-sphere>
        <a-ring radius-inner="1.65" radius-outer="2.85" rotation="75 0 0"
          material="color:#d8c3a3; opacity:0.55; transparent:true; side:double"></a-ring>
      </a-entity>

      <!-- Uranus: far front -->
      <a-entity position="-3 1.8 -16" rotation="0 0 20"
        animation__spin="property: rotation; to: 0 360 20; loop:true; dur: 1200000; easing: linear">
        <a-sphere radius="1.5" segments-width="64" segments-height="64"
          material="src:#uranusTex; roughness:1; metalness:0.02"></a-sphere>
      </a-entity>

      <!-- Moon: above -->
      <a-entity position="0.8 7.2 2"
        animation__spin="property: rotation; to: 0 360 0; loop:true; dur: 1200000; easing: linear">
        <a-sphere radius="0.75" segments-width="64" segments-height="64"
          material="src:#moonTex; roughness:1; metalness:0.0"></a-sphere>
      </a-entity>

    </a-entity>

    <!-- Shooting stars controller -->
    <a-entity id="stars" shooting-stars="minMs: 30000; maxMs: 60000; maxAlive: 1"></a-entity>

    <script>
      // Apply knobs (so you can change only the constants up top)
      const skyBack  = document.getElementById('skyBack');
      const skyFront = document.getElementById('skyFront');

      skyBack.setAttribute('animation__spin',  `property: rotation; to: 0 360 0; loop:true; dur: ${SKY_BACK_DUR_MS}; easing: linear`);
      skyFront.setAttribute('material',        `shader:flat; side:back; transparent:true; opacity:${SKY_FRONT_OPACITY}`);
      skyFront.setAttribute('animation__spin', `property: rotation; to: 0 -360 0; loop:true; dur: ${SKY_FRONT_DUR_MS}; easing: linear`);

      // Background switching (fade BOTH layers)
      let using1 = true;

      function fadeSwapSky(el, nextSrc, targetOpacity) {
        el.setAttribute('animation__fadeout', { property:'material.opacity', to:0, dur:700, easing:'easeInOutQuad' });
        setTimeout(() => {
          el.setAttribute('src', nextSrc);
          el.setAttribute('animation__fadein', { property:'material.opacity', to:targetOpacity, dur:900, easing:'easeInOutQuad' });
        }, 700);
      }

      function swapBackgrounds() {
        const next = using1 ? '#bg2' : '#bg1';
        using1 = !using1;
        fadeSwapSky(skyBack,  next, 1.0);
        fadeSwapSky(skyFront, next, SKY_FRONT_OPACITY);
      }

      setInterval(swapBackgrounds, BG_SWITCH_MS);
    </script>

  </a-scene>
</body>
</html>
